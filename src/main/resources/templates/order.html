<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>주문하기</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<form name="orderForm" id="orderForm">
    <input type="text" name="orderList[0].ProductNo" value="1234">
    <input type="text" name="orderList[0].Ea" value="1">
    <input type="text" name="orderList[1].ProductNo" value="4444">
    <input type="text" name="orderList[1].Ea" value="2">
    <input type="text" name="orderList[2].ProductNo" value="5555">
    <input type="text" name="orderList[2].Ea" value="3">

    <button type="button" onclick="orderInsert()">주문하기</button>
</form>
</body>
</html>

<script>

    function orderInsert(){

        let formObj = $("form[name='orderForm']").serializeArray();
        let orderList = []; // 데이터를 담을 배열 생성
        $.each(formObj, function(index, item) {
            let obj = {};
            obj[item.name] = item.value;
            orderList.push(obj);
        });
        console.log(orderList);
        // 요청 보내기
        $.ajax({
            url: '/api/order',
            type: 'POST',
            data: JSON.stringify(formObj), // JSON 배열로 변환하여 보내기
            headers: {
                "Authorization": localStorage.getItem("Authorization")
            },
                contentType : 'application/json',
                processData: false,
                success : function(data,text,request) {
                location.replace("/home");
            },
                error: function(request, textStatus, errorThrown){
                alert("등록실패 하였습니다.");
            }
        });
    }

    jQuery.fn.serializeObject = function() {
        var obj = null;
        try {
            if (this[0].tagName && this[0].tagName.toUpperCase() == "FORM") {
                var arr = this.serializeArray();
                if (arr) {
                    obj = {};
                    jQuery.each(arr, function() {
                        obj[this.name] = this.value;
                    });
                }//if ( arr ) {
            }
        } catch (e) {
            alert(e.message);
        } finally {
        }

        return obj;
    };

</script>